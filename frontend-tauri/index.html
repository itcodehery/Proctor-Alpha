<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Proctor</title>
  <link rel="stylesheet" href="/src/styles.css" />
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700;800&display=swap"
    rel="stylesheet">
</head>

<body>
  <div id="app">
    <!-- IDE Container (Background Layer) -->
    <div id="ide-container" class="full-screen-layer">
      <nav class="top-nav" role="navigation" aria-label="Main Navigation">
        <div class="nav-drag-handler" data-tauri-drag-region></div>
        <div class="window-controls">
          <div class="win-btn win-close" id="ide-close"></div>
          <div class="win-btn win-minimize" id="ide-minimize"></div>
          <div class="win-btn win-maximize" id="ide-maximize"></div>
        </div>
        <div class="logo-section" data-tauri-drag-region>
          <div class="logo-box">PS</div>
          <span class="logo-text">Proctor</span>
          <div class="status-indicator active-only" role="status">
            <span class="dot"></span>
            <span class="status-text">Live Session</span>
          </div>
          <div class="status-indicator paused-only" style="display: none;" role="status">
            <span class="dot"></span>
            <span class="status-text">Session Paused</span>
          </div>
        </div>

        <div class="session-info">
          <span class="session-label">Duration</span>
          <div class="session-timer" aria-live="polite">00:00</div>
          <button id="end-session-btn" class="end-session-btn" aria-haspopup="dialog">
            End Session
          </button>
        </div>
      </nav>

      <div id="main-wrapper">
        <main id="split-horizontal" class="main-content">
          <div id="col-left" class="left-column">
            <section id="pane-editor" class="window code-editor" aria-label="Code Editor">
              <div class="window-header">
                <span class="window-title">Source Editor</span>
                <div class="shortcut-info" aria-hidden="true">Alt+Shift+E</div>
              </div>
              <div class="editor-layout">
                <aside class="file-explorer" aria-label="File Explorer">
                  <div class="explorer-header">
                    <span>Files</span>
                    <div class="explorer-actions">
                      <button id="refresh-files-btn" class="icon-btn" title="Refresh">‚Üª</button>
                      <button id="new-file-btn" class="icon-btn" title="New File">+</button>
                    </div>
                  </div>
                  <div id="file-list" class="file-list">
                    <!-- Files will be listed here -->
                  </div>
                </aside>
                <div class="editor-main">
                  <div class="editor-tabs-container">
                    <div id="tab-bar" class="tab-bar">
                      <!-- Tabs will be added here -->
                    </div>
                    <div class="tab-actions">
                      <div class="auto-save-control">
                        <span id="save-status" class="save-status">Saved</span>
                        <button id="auto-save-toggle" class="icon-toggle-btn" title="Toggle Auto-Save">
                          <span class="auto-save-icon">‚ö°</span>
                        </button>
                      </div>
                      <button id="save-file-btn" class="icon-btn tab-action-btn" title="Save File (Ctrl+S)">üíæ</button>
                    </div>
                  </div>
                  <div id="monaco-container" class="window-content monaco-instance"></div>
                </div>
              </div>
            </section>

            <section id="pane-terminal" class="window terminal" aria-label="System Terminal">
              <div class="window-header">
                <span class="window-title">Terminal Shell</span>
                <div class="shortcut-info" aria-hidden="true">Alt+Shift+T</div>
              </div>
              <div id="shell-container" class="window-content"></div>
            </section>
          </div>

          <div id="col-right" class="right-column">
            <section class="window logger" aria-label="Activity Log">
              <div class="window-header">
                <span class="window-title">Activity Monitor</span>
                <div class="shortcut-info" aria-hidden="true">Alt+Shift+S</div>
              </div>
              <div class="window-content logger-content">
                <div class="log-entries" id="log-entries">
                  <!-- Log entries will be added here dynamically -->
                </div>
                <button class="export-log-btn">Export Session Log</button>
              </div>
            </section>
          </div>
        </main>
      </div>
    </div>

    <!-- Landing Page Overlay (Foreground Layer) -->
    <div id="landing-container" class="full-screen-layer landing-page">
      <!-- Landing Header for Window Controls -->
      <div class="landing-header" data-tauri-drag-region>
        <div class="window-controls">
          <div class="win-btn win-close" id="landing-close"></div>
          <div class="win-btn win-minimize" id="landing-minimize"></div>
          <div class="win-btn win-maximize" id="landing-maximize"></div>
        </div>
      </div>

      <div class="landing-content">
        <div class="landing-logo">PS</div>
        <h1 class="landing-title">Proctor<span class="highlight">Alpha</span></h1>
        <p class="landing-subtitle">Secure Examination Environment</p>

        <div class="role-selection">
          <button id="btn-admin" class="role-card admin-card">
            <div class="card-icon">üõ°Ô∏è</div>
            <div class="card-text">
              <span class="role-title">Admin</span>
              <span class="role-desc">Monitor sessions & logs</span>
            </div>
          </button>

          <button id="btn-student" class="role-card student-card">
            <div class="card-icon">üë®‚Äçüíª</div>
            <div class="card-text">
              <span class="role-title">Student</span>
              <span class="role-desc">Enter exam environment</span>
            </div>
          </button>
        </div>
      </div>
    </div>

    <!-- Admin Dashboard Overlay (Top Layer) -->
    <div id="admin-container" class="full-screen-layer admin-dashboard fade-out">
      <!-- Admin Header -->
      <nav class="top-nav" role="navigation" aria-label="Admin Navigation">
        <div class="nav-drag-handler" data-tauri-drag-region></div>
        <div class="window-controls">
          <div class="win-btn win-close" id="admin-close"></div>
          <div class="win-btn win-minimize" id="admin-minimize"></div>
          <div class="win-btn win-maximize" id="admin-maximize"></div>
        </div>

        <div class="logo-section" data-tauri-drag-region>
          <div class="logo-box admin-logo-box">AD</div>
          <span class="logo-text">Admin<span class="highlight">Panel</span></span>
          <div class="server-status-indicator" id="server-status-indicator" title="Server Status">
            <span class="status-dot"></span>
            <span class="status-text">OFFLINE</span>
          </div>
        </div>

        <div class="session-info">
          <button id="admin-back-btn" class="icon-toggle-btn" style="margin-right: 12px;">
            ‚Üê Back
          </button>
          <button id="create-room-btn" class="end-session-btn"
            style="border-color: var(--accent-primary); color: var(--accent-primary);">
            + Create Room
          </button>
        </div>
      </nav>

      <div class="admin-content">
        <!-- Status Cards -->
        <div class="admin-status-cards">
          <div class="status-card" id="process-shield-card">
            <div class="card-icon">üõ°Ô∏è</div>
            <div class="card-info">
              <h3>Process Shield</h3>
              <p id="shield-status-text">Inactive</p>
            </div>
            <button class="small-btn" id="monitor-shield-btn">Monitor</button>
          </div>

          <div class="status-card instruction-card">
            <div class="card-icon">‚ÑπÔ∏è</div>
            <div class="card-info">
              <h3>Instructions</h3>
              <p>1. Ensure Server is <strong>ONLINE</strong> (Auto-starts).</p>
              <p>2. Create a Room & Share <strong>Host ID</strong>.</p>
              <p>3. Students enter Host ID to join.</p>
            </div>
          </div>
        </div>

        <div class="content-header">
          <h2>Exam Rooms</h2>
          <button id="refresh-rooms-btn" class="icon-btn" title="Refresh List">‚Üª</button>
        </div>

        <div class="table-container">
          <table class="data-table">
            <thead>
              <tr>
                <th>Room ID</th>
                <th>Session Name</th>
                <th>Status</th>
                <th>Start Time</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="rooms-list-body">
              <!-- Rows will be populated via JS -->
            </tbody>
          </table>
          <div id="rooms-loading" class="loading-state" style="display: none;">Loading rooms...</div>
          <div id="rooms-empty" class="empty-state" style="display: none;">No rooms found. Create one to get started.
          </div>
        </div>
      </div>

      <!-- Room Details Overlay (Drill Down) -->
      <div id="room-details-view" class="drill-down-view">
        <div class="view-header">
          <button id="rd-back-btn" class="icon-toggle-btn">‚Üê Back</button>
          <h2 id="rd-title">Room Details</h2>
          <div class="action-group">
            <span id="rd-status-badge" class="status-badge status-waiting">WAITING</span>
            <button id="rd-save-btn" class="end-session-btn" style="padding: 6px 16px;">Save Changes</button>
          </div>
        </div>

        <div class="tabs">
          <button class="tab-btn active" data-tab="students">Students</button>
          <button class="tab-btn" data-tab="settings">Settings</button>
          <button class="tab-btn" data-tab="sets">Sets (Q&A)</button>
        </div>

        <div class="tab-content active" id="tab-students">
          <table class="data-table">
            <thead>
              <tr>
                <th>Reg No.</th>
                <th>Name</th>
                <th>Status</th>
                <th>IP Address</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="rd-students-body"></tbody>
          </table>
          <div id="rd-students-empty" class="empty-state">No students joined yet.</div>
        </div>

        <div class="tab-content" id="tab-settings" style="display: none;">
          <div class="form-grid">
            <div class="form-group">
              <label>Session Name</label>
              <input type="text" id="rd-name" class="admin-input">
            </div>
            <div class="form-group">
              <label>Duration (Minutes)</label>
              <input type="number" id="rd-duration" class="admin-input">
            </div>
            <div class="form-group">
              <label>Admin Key (Verify to Save)</label>
              <input type="password" id="rd-key" class="admin-input" placeholder="Required to save">
            </div>
            <div class="form-group">
              <label>Room Status</label>
              <select id="rd-status-select" class="admin-input">
                <option value="0">Waiting</option>
                <option value="1">Active</option>
                <option value="3">Paused</option>
                <option value="4">Complete</option>
              </select>
            </div>
          </div>
        </div>

        <div class="tab-content" id="tab-sets" style="display: none;">
          <div class="sets-editor">
            <div id="sets-container">
              <!-- Dynamic Rows -->
            </div>
            <button id="add-set-btn" class="small-btn" style="align-self: flex-start; margin-top: 12px;">+ Add
              Set</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Join Room Container (Student Flow) -->
    <div id="join-room-container" class="full-screen-layer join-room-container fade-out">
      <!-- Header -->
      <nav class="top-nav" role="navigation" aria-label="Join Room Navigation">
        <div class="nav-drag-handler" data-tauri-drag-region></div>
        <div class="window-controls">
          <div class="win-btn win-close" id="join-close"></div>
          <div class="win-btn win-minimize" id="join-minimize"></div>
          <div class="win-btn win-maximize" id="join-maximize"></div>
        </div>

        <div class="logo-section" data-tauri-drag-region>
          <div class="logo-box student-logo-box">ST</div>
          <span class="logo-text">Student<span class="highlight">Portal</span></span>
        </div>

        <div class="session-info">
          <button id="join-back-btn" class="icon-toggle-btn">‚Üê Back</button>
        </div>
      </nav>

      <div class="join-content">
        <div class="join-card">
          <h2 class="join-title">Join Exam Session</h2>
          <p class="join-subtitle">Enter your details and the room ID provided by your proctor.</p>

          <div class="form-group">
            <label>Full Name</label>
            <input type="text" id="join-name" class="admin-input" placeholder="John Doe">
          </div>

          <div class="form-group">
            <label>Registration Number</label>
            <input type="text" id="join-regno" class="admin-input" placeholder="REG-2024-001">
          </div>

          <div class="form-group">
            <label>Room ID</label>
            <input type="text" id="join-room-id" class="admin-input" placeholder="Enter Room ID">
          </div>

          <div class="form-group">
            <label>Server IP</label>
            <input type="text" id="join-server-ip" class="admin-input" placeholder="Server IP (e.g., 192.168.1.5)">
          </div>

          <div id="join-error" class="error-message"
            style="display: none; color: var(--accent-danger); margin-bottom: 1rem;"></div>

          <button id="join-submit-btn" class="end-session-btn" style="width: 100%;">
            Join Session
          </button>
        </div>
      </div>
    </div>

    <!-- Create Room Dialog -->
    <div id="create-room-dialog" class="dialog-overlay" role="dialog" aria-modal="true">
      <div class="modal">
        <div class="modal-close-icon" id="create-room-close" role="button">‚úï</div>
        <h2 class="modal-title">Create Exam Session</h2>

        <div class="form-group">
          <label>Session Name</label>
          <input type="text" id="cr-name" class="admin-input" placeholder="e.g. Mid-Term Physics">
        </div>

        <div class="form-group">
          <label>Host ID (Examiner)</label>
          <input type="text" id="cr-host" class="admin-input" placeholder="EMP123">
        </div>

        <div class="form-group">
          <label>Admin Key</label>
          <input type="password" id="cr-key" class="admin-input" placeholder="Secret Key">
        </div>

        <button id="cr-submit-btn" class="end-session-btn" style="width: 100%; margin-top: 16px;">
          Create Room
        </button>
      </div>
    </div>

    <!-- Enhanced Confirmation Dialog -->
    <div id="dialog-overlay" class="dialog-overlay" role="dialog" aria-modal="true" aria-labelledby="modal-title">
      <div class="modal">
        <div class="modal-close-icon" role="button" aria-label="Close dialog">‚úï</div>
        <div class="modal-icon">!</div>
        <h2 id="modal-title" class="modal-title">End Session?</h2>
        <p class="modal-text">Enter the Admin Key to finalize and export this session. All workspace files will be
          saved.</p>

        <div class="admin-input-container">
          <input type="password" class="admin-input" id="admin-input" placeholder="Enter Admin Key"
            aria-label="Admin Key" />
        </div>
      </div>
    </div>

    <!-- New File Dialog -->
    <div id="new-file-dialog" class="dialog-overlay" role="dialog" aria-modal="true" aria-labelledby="new-file-title">
      <div class="modal">
        <div class="modal-close-icon" id="new-file-close-icon" role="button" aria-label="Close dialog">‚úï</div>
        <div class="modal-icon"
          style="background: rgba(16, 185, 129, 0.1); color: var(--accent-primary); border-color: var(--accent-primary);">
          +</div>
        <h2 id="new-file-title" class="modal-title">New File</h2>
        <p class="modal-text">Enter the name for the new file (e.g., script.py)</p>

        <div class="admin-input-container">
          <input type="text" class="admin-input" id="new-file-input" placeholder="filename.ext"
            aria-label="File Name" />
        </div>
        <div style="margin-top: 24px;">
          <button id="create-file-confirm-btn" class="end-session-btn"
            style="width: 100%; border-color: var(--accent-primary); color: var(--accent-primary);">Create File</button>
        </div>
      </div>
    </div>
  </div>
  <script type="module" src="/src/main.js"></script>
</body>

</html>